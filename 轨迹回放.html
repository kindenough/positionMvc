<!doctype html>
<html lang="zh-CN">

<head>
    <!-- 原始地址：//webapi.amap.com/ui/1.0/ui/misc/PathSimplifier/examples/simple-demo.html -->
    <base href="//webapi.amap.com/ui/1.0/ui/misc/PathSimplifier/examples/" />
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>简单路径</title>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
    html,
    body,
    #container {
        width: 100%;
        height: 100%;
        margin: 0px;
    }
    </style>  
    <style>
        .amap-logo, .amap-copyright {
            display: none!important;
        }
    </style>
</head>

<body>
    <div style="position:absolute;left:10px;top:10px;z-index:99999;">
        <label>开始:</label><input id="dt1" type="datetime-local" value=""/><br />
        <label>结束:</label><input id="dt2" type="datetime-local" value=""/><br /><!--2017-11-16T11:54-->
        <button onclick="ok()">确定</button>
        <button onclick="demo1()">例子</button>
    </div>
    <div id="container"></div>
    <script type="text/javascript" src='//webapi.amap.com/maps?v=1.4.1&key=您申请的key值'></script>
    <!-- UI组件库 1.0 -->
    <script src="//webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>
    <script type="text/javascript">
        document.getElementById("dt1").value = getNowFormatDate(10);
        document.getElementById("dt2").value = getNowFormatDate(0);
        var g_navg1 = null;
        //创建地图
        var map = new AMap.Map('container', {
            zoom: 4
        });
        //init();

        function pathMove(pts) {
         AMapUI.load(['ui/misc/PathSimplifier', 'lib/$'], function (PathSimplifier, $) {

            if (!PathSimplifier.supportCanvas) {
                alert('当前环境不支持 Canvas！');
                return;
            }

            var pathSimplifierIns = new PathSimplifier({
                zIndex: 100,
                //autoSetFitView:false,
                map: map, //所属的地图实例

                getPath: function (pathData, pathIndex) {

                    return pathData.path;
                },
                getHoverTitle: function (pathData, pathIndex, pointIndex) {

                    if (pointIndex >= 0) {
                        //point 
                        return pathData.name + '，点：' + pointIndex + '/' + pathData.path.length;
                    }

                    return pathData.name + '，点数量' + pathData.path.length;
                },
                renderOptions: {

                    renderAllPointsIfNumberBelow: 100 //绘制路线节点，如不需要可设置为-1
                }
            });

            window.pathSimplifierIns = pathSimplifierIns;

            //设置数据
            pathSimplifierIns.setData([{
                name: '路线0',
                path: pts
            }]);

            function onload() {
                pathSimplifierIns.renderLater();
            }

            function onerror(e) {
                alert('图片加载失败！');
            }

            //对第一条线路（即索引 0）创建一个巡航器
            var navg1 = pathSimplifierIns.createPathNavigator(0, {
                loop: true, //循环播放
                speed: 500, //巡航速度，单位千米/小时
                //pathNavigatorStyle: {
                //    width: 16,
                //    height: 32,
                //    content: PathSimplifier.Render.Canvas.getImageContent('http://www.maomx.cn/car.png', onload, onerror),
                //    strokeStyle: null,
                //    fillStyle: null
                //}
            });
            g_navg1 = navg1;
            navg1.start();
            
        });

        }

        function init() {
            var pts=[
                    [118.185989, 24.481261],
                    [118.18646, 24.48112332],
                    [118.1865609, 24.4811141],
                    [118.1866124, 24.48111437],
                    [118.1865679, 24.48123969],
                    [118.1865712, 24.48110162],
                    [118.186629, 24.48111708],
                    [118.1866599, 24.48115994],
                    [118.1866878, 24.48128961],
                    [118.186731, 24.4813775],
                    [118.1867649, 24.48149007],
                    [118.1868167, 24.48156141],
                    [118.1868237, 24.48163086],
                    [118.186872, 24.4817296],
                    [118.1869173, 24.48181125],
                    [118.1869078, 24.48189372],
                    [118.1869642, 24.48195095],
                    [118.1869786, 24.48204753],
                    [118.186977, 24.48215332],
                    [118.1870117, 24.48224908],
                    [118.187057, 24.48231418],
                    [118.1871441, 24.48237739],
                    [118.1871701, 24.4824745],
                    [118.1871875, 24.48256999],
                    [118.1871305, 24.48261637],
                    [118.1870915, 24.48266168],
                    [118.18705, 24.48272786],
                    [118.1869892, 24.4828616],
                    [118.1869233, 24.48289958],
                    [118.1868115, 24.48291585],
                    [118.1867082, 24.48291558],
                    [118.1866504, 24.48297228],
                    [118.1866376, 24.4830089],
                    [118.1865766, 24.48299533],
                    [118.1865495, 24.48296821],
                    [118.1865313, 24.48291911],
                    [118.1865031, 24.48289931],
                    [118.1865044, 24.48289741],
                    [118.1865044, 24.48289741],
                    [118.1863422, 24.48274306],
                    [118.1863227, 24.48275391],
                    [118.1863105, 24.48275445],
                    [118.1863029, 24.48275608],
                    [118.186212, 24.48274767],
                    [118.1859752, 24.48306912],
                    [118.1858013, 24.48321072],
                    [118.1856613, 24.48327284],
                    [118.185583, 24.48332845],
                    [118.1855062, 24.48335612],
                    [118.1854899, 24.48338216],
                    [118.185501, 24.48339437],
                    [118.1855227, 24.4834592],
                    [118.1855216, 24.48350857],
                    [118.1855377, 24.48354818],
                    [118.1855873, 24.4836244],
                    [118.185619, 24.48372369],
                    [118.185622, 24.48382785],
                    [118.1856432, 24.4839171],
                    [118.1856171, 24.48399929],
                    [118.1856396, 24.48404514],
                    [118.1856725, 24.48410075],
                    [118.1856993, 24.48420926],
                    [118.1857199, 24.48428141],
                    [118.1857387, 24.48438585],
                    [118.1857303, 24.48446804],
                    [118.1857723, 24.48456028],
                    [118.1858005, 24.48467801],
                    [118.185832, 24.4847914],
                    [118.1858583, 24.48487549],
                    [118.1858933, 24.48492676],
                    [118.1858455, 24.48493354],
                    [118.1858762, 24.48498372],
                    [118.1858813, 24.48505859],
                    [118.1859066, 24.48515001],
                    [118.1858708, 24.48521566],
                    [118.1858626, 24.48528429],
                    [118.1858561, 24.48532986],
                    [118.1859039, 24.48539578],
                    [118.1859087, 24.48546549],
                    [118.1858626, 24.48550646],
                    [118.1858024, 24.4855466],
                    [118.1857221, 24.48559435],
                    [118.1856253, 24.48562446],
                    [118.1855211, 24.48564616],
                    [118.1854194, 24.48566732],
                    [118.1853182, 24.48569282],
                    [118.185223, 24.48570828],
                    [118.1851082, 24.48570231],
                    [118.1849748, 24.48571126],
                    [118.1848633, 24.48570828],
                    [118.1847624, 24.48573595],
                    [118.1844756, 24.48585775],
                    [118.1844293, 24.48588704],
                    [118.1843316, 24.48592801],
                    [118.1842109, 24.48587565],
                    [118.184062, 24.48592529],
                    [118.1839678, 24.48593018],
                    [118.1838129, 24.48595947],
                    [118.1836879, 24.48600098],
                    [118.1836005, 24.48602865],
                    [118.1834307, 24.48610731],
                    [118.1833038, 24.48617432],
                    [118.1831624, 24.48617486],
                    [118.1830146, 24.48625244],
                    [118.182934, 24.48628554],
                    [118.1827913, 24.48631646],
                    [118.1827007, 24.48631565],
                    [118.1825779, 24.48634359],
                    [118.1824829, 24.48638373],
                    [118.1823904, 24.48645752],
                    [118.1822938, 24.48649984],
                    [118.1821799, 24.48655436],
                    [118.1820711, 24.48663276],
                    [118.1819596, 24.48663249],
                    [118.1818568, 24.48665148],
                    [118.1817651, 24.48672716],
                    [118.1817177, 24.48674506],
                    [118.1817177, 24.48674506],
                    [118.183071, 24.486194],
                    [118.183071, 24.486194],
                    [118.183071, 24.486194],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.181286, 24.486812],
                    [118.180806, 24.486998],
                    [118.180806, 24.486998],
                    [118.180806, 24.486998],
                    [118.1795736, 24.48784288],
                    [118.179503, 24.48797092],
                    [118.1793161, 24.48803033],
                    [118.1793769, 24.48807075],
                    [118.1793156, 24.48814155],
                    [118.1791911, 24.48820882],
                    [118.1790845, 24.48828369],
                    [118.1789977, 24.48832113],
                    [118.1789423, 24.48835693],
                    [118.1789157, 24.48842909],
                    [118.1789559, 24.48850071],
                    [118.1789868, 24.48859158],
                    [118.1790294, 24.48864312],
                    [118.1790446, 24.48872233],
                    [118.1790148, 24.48882026],
                    [118.1789277, 24.48888536],
                    [118.1788352, 24.48897407],
                    [118.1787611, 24.48903537],
                    [118.1787259, 24.48902317],
                    [118.178654, 24.48905165],
                    [118.1785655, 24.48909451],
                    [118.1784752, 24.48916395],
                    [118.1784066, 24.48922987],
                    [118.1783493, 24.48924995],
                    [118.1783173, 24.48924235],
                    [118.17831, 24.48927382],
                    [118.1782544, 24.48933078],
                    [118.1781893, 24.48942084],
                    [118.1780962, 24.48948839],
                    [118.1779728, 24.48957845],
                    [118.1779549, 24.48966688],
                    [118.1779178, 24.48970269],
                    [118.1778781, 24.48974338],
                    [118.1778697, 24.48976481],
                    [118.1778263, 24.48978082],
                    [118.177822, 24.48982395],
                    [118.1777601, 24.48990804],
                    [118.1777496, 24.48996094],
                    [118.1776861, 24.4900198],
                    [118.1776489, 24.49009494],
                    [118.1776134, 24.49017307],
                    [118.1775662, 24.4902577],
                    [118.1774894, 24.49033854],
                    [118.1774349, 24.49047173],
                    [118.1773912, 24.49054281],
                    [118.1773201, 24.49061252],
                    [118.1772626, 24.49074002],
                    [118.177187, 24.49085829],
                    [118.1771096, 24.49095812],
                    [118.177204, 24.49132243],
                    [118.1772437, 24.49142036],
                    [118.1767695, 24.49220432],
                    [118.1766838, 24.49223443],
                    [118.1766504, 24.49223687],
                    [118.1766037, 24.49219428],
                    [118.1765904, 24.49218777],
                    [118.1765666, 24.49219157],
                    [118.1765408, 24.49213677],
                    [118.1765454, 24.49213569],
                    [118.1765194, 24.49211616],
                    [118.1764445, 24.49211127],
                    [118.1766238, 24.49212212],
                    [118.1766043, 24.49218343],
                    [118.176613, 24.49215956],
                    [118.1766024, 24.49217367],
                    [118.1766016, 24.49219021],
                    [118.1766067, 24.49218506],
                    [118.1766195, 24.49217475],
                    [118.1766249, 24.49216797],
                    [118.1766246, 24.49216851],
                    [118.1766249, 24.49216824],
                    [118.1766252, 24.49216797],
                    [118.1766252, 24.49216797],
                    [118.176739, 24.492126],
                    [118.176739, 24.492126],
                    [118.176739, 24.492126]
                            ];
            pathMove(pts);
        }

        function ok() {
            var dt1 = document.getElementById("dt1").value.replace("T", " ");
            var dt2 = document.getElementById("dt2").value.replace("T", " ");
            var p = JSON.stringify({ "starttime": dt1, "endtime": dt2 });
            //$.ajax({
            //    type: "post",
            //    url: "http://www.maomx.cn/Position/Post",
            //    data: { "": "Jim" },
            //    success: function (data, status) {
            //        alert(data);
            //    }
            //});

            $.ajax({
                type: 'POST',
                //url: "http://localhost:29256/Position/postStartEnd",
                url: "http://wncg.kingtopinfo.com/mymvc4/Position/postStartEnd",
                dataType: 'json',
                data: JSON.stringify({ "starttime": dt1, "endtime": dt2 }),
                //data: { "starttime": dt1, "endtime": dt2 },
                //data: {"":"test"},
                contentType: 'application/json;charset=utf-8',
                success: function (data) {
                    //alert(data);
                    var pts = JSON.parse(data);
                    if (g_navg1) {
                       // g_navg1.destroy();
                        g_navg1 = null;
                        window.pathSimplifierIns.hide();
                    }
                    pathMove(pts);
                },
                error: function (XMLHttpRequest,textStatus,errorThrown) {
                    alert(errorThrown);
                }
            });
        }

        function demo1() {
            document.getElementById("dt1").value = "2017-11-16T11:40";
            document.getElementById("dt2").value = "2017-11-16T11:55";
            ok();
        }

        function getNowFormatDate(n) {
            var date = new Date();
            if (!isNaN(n)) {
                date.setMinutes(date.getMinutes() - n);
            }
            var seperator1 = "-";
            var seperator2 = ":";
            var month = date.getMonth() + 1;
            var strDate = date.getDate();
            if (month >= 1 && month <= 9) {
                month = "0" + month;
            }
            if (strDate >= 0 && strDate <= 9) {
                strDate = "0" + strDate;
            }

            var nHour = date.getHours();
            nHour = nHour < 10 ? ("0" + nHour) : nHour;
            var nMin = parseInt(date.getMinutes());
            nMin = nMin < 10 ? ("0" + nMin) : nMin;
            var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
                    + "T" + nHour + seperator2 + nMin;
                    //+ seperator2 + date.getSeconds();
            return currentdate;
        }
    </script>
</body>

</html>